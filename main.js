(()=>{let e=["x","/","-","+","."],l="",t=[],n="",c=document.querySelector(".input"),i=document.querySelector(".story");function u(u){let r="string"==typeof u?u:this.attributes.inTo.value;if("AC"==r)return!l&&c.value&&(l=c.value),l?c.value=n=l="":(i.innerHTML="",!1);if("="==r){l!=c.value&&(l=c.value),l=e.includes(l[l.length-1])?l.slice(0,-1):l,l=e.includes(l[l.length-1])?l.slice(0,-1):l;let u=n?`(${n.split("=")[0]})${l.replace(n.split("=")[1],"")}`:l,r=function(e){e=e.replaceAll(" ","").replaceAll("+"," + ").replaceAll("x"," * ").replaceAll("-"," - ").replaceAll("/"," / ").split(" ");for(let l=0;l<e.length;l++)""==e[l]&&(e.splice(l,2),e[l]="-"+e[l]);let l=document.createElement("calc");l.style.opacity=`calc(${e.join(" ")})`;let t=parseFloat(l.style.opacity.replace("calc(","").replace(")",""));return l.remove(),t}(u);return n=`${u}=${r}`,t.push(`${l}=${r}`),i.innerHTML+=`<i>${t[t.length-1]}</i>`,l=c.value=r,!1}if("+/-"==r)return l=c.value=l.slice(0,-1),!1;(t.length&&"."==r||!l&&"."==r)&&(r="0."),e.includes(l[l.length-1])&&e.includes(r)&&("-"!=r&&e.includes(l[l.length-1])&&(l=l.slice(0,-1)),("-"==r&&"-"==l[l.length-1]||"-"==r&&"+"==l[l.length-1])&&(l=l.slice(0,-1)),"-"!=r&&e.includes(l[l.length-1])&&(l=l.slice(0,-1))),""==l&&e.includes(r)&&"-"!=r&&(r=""),t.length&&!e.includes(r)&&(l="",n=""),t=[],l+=r,c.value=l}c.onkeyup=function(e){console.log(e),"Enter"==e.key&&u("=")},c.oninput=function(e){return u("deleteContentBackward"==e.inputType?"+/-":e.data),!1},[...document.querySelectorAll("button")].forEach(function(e){e.onclick=u})})();